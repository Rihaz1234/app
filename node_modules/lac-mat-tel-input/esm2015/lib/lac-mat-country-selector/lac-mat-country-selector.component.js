import { __decorate, __metadata } from "tslib";
import { Component, Input, EventEmitter, Output, ViewEncapsulation, ViewChild } from '@angular/core';
import { CountryCode } from '../data/country-code';
import { LacMatTelInputComponent } from '../lac-mat-tel-input.component';
import { MatInput } from '@angular/material/input';
let LacMatCountrySelectorComponent = class LacMatCountrySelectorComponent {
    constructor(countryCodeData) {
        this.countryCodeData = countryCodeData;
        this.preferredCountries = [];
        this.onlyCountries = [];
        this.change = new EventEmitter();
        this.allCountries = [];
        this.preferredCountriesInDropDown = [];
        this.fetchCountryData();
    }
    get disabled() {
        return this.selectorFor && this.selectorFor.disabled;
    }
    //builds the All Countries array
    fetchCountryData() {
        this.countryCodeData.allCountries.forEach(c => {
            const country = {
                name: c[0].toString(),
                iso2: c[1].toString(),
                dialCode: c[2].toString(),
                priority: +c[3] || 0,
                areaCodes: c[4] || undefined,
                flagClass: c[1].toString().toUpperCase(),
                placeHolder: ''
            };
            this.allCountries.push(country);
        });
    }
    ngOnInit() {
        //build preferred countries arrays if they are specified
        if (this.preferredCountries.length) {
            this.preferredCountries.forEach(iso2 => {
                const preferredCountry = this.allCountries.filter((c) => {
                    return c.iso2 === iso2;
                });
                this.preferredCountriesInDropDown.push(preferredCountry[0]);
            });
        }
        //filter countries if required
        if (this.onlyCountries.length) {
            this.allCountries = this.allCountries.filter(c => this.onlyCountries.includes(c.iso2));
        }
        //set the default selected a country
        let defaultCountry;
        if (this.preferredCountriesInDropDown.length) {
            defaultCountry = this.preferredCountriesInDropDown[0];
        }
        else {
            defaultCountry = this.allCountries[0];
        }
        if (this.selectorFor) {
            this.countrySubscription = this.selectorFor.countryChange.subscribe(c => this.onCountryUpdateFromInput(c));
        }
        this.selectCountry(defaultCountry);
    }
    ngOnDestroy() {
        if (this.countrySubscription) {
            this.countrySubscription.unsubscribe();
        }
    }
    selectCountry(country) {
        this.selectedCountry = country;
        if (this.selectorFor) {
            this.selectorFor.onCountrySelected(country.flagClass);
        }
        this.change.next(country);
    }
    onCountryUpdateFromInput(code) {
        let country = this.allCountries.find((c) => {
            return c.flagClass === code.toString();
        });
        this.selectedCountry = country;
        this.change.next(country);
    }
    onOpenMenuClick() {
        if (!this.disableSearch && this.searchInput) {
            setTimeout(() => this.searchInput.focus());
        }
    }
    onMenuClosed() {
        this.searchQuery = '';
    }
};
LacMatCountrySelectorComponent.ctorParameters = () => [
    { type: CountryCode }
];
__decorate([
    Input(),
    __metadata("design:type", LacMatTelInputComponent)
], LacMatCountrySelectorComponent.prototype, "selectorFor", void 0);
__decorate([
    Input(),
    __metadata("design:type", Array)
], LacMatCountrySelectorComponent.prototype, "preferredCountries", void 0);
__decorate([
    Input(),
    __metadata("design:type", Array)
], LacMatCountrySelectorComponent.prototype, "onlyCountries", void 0);
__decorate([
    Input(),
    __metadata("design:type", Boolean)
], LacMatCountrySelectorComponent.prototype, "showDialCode", void 0);
__decorate([
    Input(),
    __metadata("design:type", Boolean)
], LacMatCountrySelectorComponent.prototype, "disableSearch", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], LacMatCountrySelectorComponent.prototype, "searchPlaceholder", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], LacMatCountrySelectorComponent.prototype, "change", void 0);
__decorate([
    ViewChild('searchInput'),
    __metadata("design:type", MatInput)
], LacMatCountrySelectorComponent.prototype, "searchInput", void 0);
LacMatCountrySelectorComponent = __decorate([
    Component({
        selector: 'lac-mat-country-selector',
        template: "<ng-container *ngIf=\"selectedCountry\">\n  <button type=\"button\" [matMenuTriggerFor]=\"menu\" mat-button class=\"country-selector\" (click)=\"onOpenMenuClick()\" [disabled]=\"disabled\">\n    <span class=\"country-selector-flag flag\" [ngClass]=\"selectedCountry.flagClass\"></span>\n    <span class=\"country-selector-code\" [hidden]=\"!showDialCode\">+{{selectedCountry.dialCode}}</span>\n    <span class=\"country-arrow\"></span>\n  </button>\n  <mat-menu #menu=\"matMenu\" (closed)=\"onMenuClosed()\">\n    <div class=\"country-search-container\">\n      <mat-form-field class=\"country-search\" *ngIf=\"!disableSearch\" appearance=\"outline\" (click)=\"$event.stopPropagation()\" >\n        <input matInput [(ngModel)]=\"searchQuery\" type=\"text\" [placeholder]=\"searchPlaceholder\" #searchInput=\"matInput\" />\n      </mat-form-field>\n    </div>\n    \n    <div class=\"countries-container\">\n      <button type=\"button\" mat-menu-item class=\"country-list-button\" *ngFor=\"let country of preferredCountriesInDropDown\" (click)=\"selectCountry(country)\">\n        <div class=\"icon-wrapper\">\n          <div class=\"flag\" [ngClass]=\"country.flagClass\"></div>\n        </div>\n        <div class=\"label-wrapper\">{{country.name}} +{{country.dialCode}}</div>\n      </button>\n      <mat-divider *ngIf=\"preferredCountriesInDropDown?.length\"></mat-divider>\n      \n      <ng-container *ngFor=\"let country of allCountries\">\n        <button type=\"button\" mat-menu-item class=\"country-list-button\" *ngIf=\"country.name | search:searchQuery\" (click)=\"selectCountry(country)\">\n          <div class=\"icon-wrapper\">\n            <div class=\"flag\" [ngClass]=\"country.flagClass\"></div>\n          </div>\n          <div class=\"label-wrapper\">{{country.name}} +{{country.dialCode}}</div>\n        </button>\n      </ng-container>\n    </div>\n  </mat-menu>\n</ng-container>",
        providers: [CountryCode],
        encapsulation: ViewEncapsulation.None,
        styles: [".flag{background-image:url(https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/flags_sprite_2x.png);background-size:100% auto;-webkit-filter:drop-shadow(1px 1px 1px rgba(0, 0, 0, .54));filter:drop-shadow(1px 1px 1px rgba(0, 0, 0, .54));height:14px;width:24px}.country-selector-flag{display:inline-block;margin-right:5px}.country-selector-code{margin-right:5px;font-size:initial;font-weight:initial}.icon-wrapper,.label-wrapper{display:table-cell;vertical-align:middle}.icon-wrapper{padding-right:15px}.country-arrow{width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:5px solid;margin:0 4px;color:rgba(0,0,0,.54);display:table-cell;vertical-align:middle}.country-search-container{padding:10px}.mat-form-field.country-search{width:100%}.mat-form-field.country-search .mat-form-field-infix{padding:0 0 10px}.mat-form-field.country-search .mat-form-field-wrapper{padding-bottom:0}.flag.KY{background-position:0 0}.flag.AC{background-position:0 -14px}.flag.AE{background-position:0 -28px}.flag.AF{background-position:0 -42px}.flag.AG{background-position:0 -56px}.flag.AI{background-position:0 -70px}.flag.AL{background-position:0 -84px}.flag.AM{background-position:0 -98px}.flag.AO{background-position:0 -112px}.flag.AQ{background-position:0 -126px}.flag.AR{background-position:0 -140px}.flag.AS{background-position:0 -154px}.flag.AT{background-position:0 -168px}.flag.AU{background-position:0 -182px}.flag.AW{background-position:0 -196px}.flag.AX{background-position:0 -210px}.flag.AZ{background-position:0 -224px}.flag.BA{background-position:0 -238px}.flag.BB{background-position:0 -252px}.flag.BD{background-position:0 -266px}.flag.BE{background-position:0 -280px}.flag.BF{background-position:0 -294px}.flag.BG{background-position:0 -308px}.flag.BH{background-position:0 -322px}.flag.BI{background-position:0 -336px}.flag.BJ{background-position:0 -350px}.flag.BL{background-position:0 -364px}.flag.BM{background-position:0 -378px}.flag.BN{background-position:0 -392px}.flag.BO{background-position:0 -406px}.flag.BQ{background-position:0 -420px}.flag.BR{background-position:0 -434px}.flag.BS{background-position:0 -448px}.flag.BT{background-position:0 -462px}.flag.BV{background-position:0 -476px}.flag.BW{background-position:0 -490px}.flag.BY{background-position:0 -504px}.flag.BZ{background-position:0 -518px}.flag.CA{background-position:0 -532px}.flag.CC{background-position:0 -546px}.flag.CD{background-position:0 -560px}.flag.CF{background-position:0 -574px}.flag.CG{background-position:0 -588px}.flag.CH{background-position:0 -602px}.flag.CI{background-position:0 -616px}.flag.CK{background-position:0 -630px}.flag.CL{background-position:0 -644px}.flag.CM{background-position:0 -658px}.flag.CN{background-position:0 -672px}.flag.CO{background-position:0 -686px}.flag.CP{background-position:0 -700px}.flag.CR{background-position:0 -714px}.flag.CU{background-position:0 -728px}.flag.CV{background-position:0 -742px}.flag.CW{background-position:0 -756px}.flag.CX{background-position:0 -770px}.flag.CY{background-position:0 -784px}.flag.CZ{background-position:0 -798px}.flag.DE{background-position:0 -812px}.flag.DG{background-position:0 -826px}.flag.DJ{background-position:0 -840px}.flag.DK{background-position:0 -854px}.flag.DM{background-position:0 -868px}.flag.DO{background-position:0 -882px}.flag.DZ{background-position:0 -896px}.flag.EA{background-position:0 -910px}.flag.EC{background-position:0 -924px}.flag.EE{background-position:0 -938px}.flag.EG{background-position:0 -952px}.flag.EH{background-position:0 -966px}.flag.ER{background-position:0 -980px}.flag.ES{background-position:0 -994px}.flag.ET{background-position:0 -1008px}.flag.EU{background-position:0 -1022px}.flag.FI{background-position:0 -1036px}.flag.FJ{background-position:0 -1050px}.flag.FK{background-position:0 -1064px}.flag.FM{background-position:0 -1078px}.flag.FO{background-position:0 -1092px}.flag.FR{background-position:0 -1106px}.flag.GA{background-position:0 -1120px}.flag.GB{background-position:0 -1134px}.flag.GD{background-position:0 -1148px}.flag.GE{background-position:0 -1162px}.flag.GF{background-position:0 -1176px}.flag.GG{background-position:0 -1190px}.flag.GH{background-position:0 -1204px}.flag.GI{background-position:0 -1218px}.flag.GL{background-position:0 -1232px}.flag.GM{background-position:0 -1246px}.flag.GN{background-position:0 -1260px}.flag.GP{background-position:0 -1274px}.flag.GQ{background-position:0 -1288px}.flag.GR{background-position:0 -1302px}.flag.GS{background-position:0 -1316px}.flag.GT{background-position:0 -1330px}.flag.GU{background-position:0 -1344px}.flag.GW{background-position:0 -1358px}.flag.GY{background-position:0 -1372px}.flag.HK{background-position:0 -1386px}.flag.HM{background-position:0 -1400px}.flag.HN{background-position:0 -1414px}.flag.HR{background-position:0 -1428px}.flag.HT{background-position:0 -1442px}.flag.HU{background-position:0 -1456px}.flag.IC{background-position:0 -1470px}.flag.ID{background-position:0 -1484px}.flag.IE{background-position:0 -1498px}.flag.IL{background-position:0 -1512px}.flag.IM{background-position:0 -1526px}.flag.IN{background-position:0 -1540px}.flag.IO{background-position:0 -1554px}.flag.IQ{background-position:0 -1568px}.flag.IR{background-position:0 -1582px}.flag.IS{background-position:0 -1596px}.flag.IT{background-position:0 -1610px}.flag.JE{background-position:0 -1624px}.flag.JM{background-position:0 -1638px}.flag.JO{background-position:0 -1652px}.flag.JP{background-position:0 -1666px}.flag.KE{background-position:0 -1680px}.flag.KG{background-position:0 -1694px}.flag.KH{background-position:0 -1708px}.flag.KI{background-position:0 -1722px}.flag.KM{background-position:0 -1736px}.flag.KN{background-position:0 -1750px}.flag.KP{background-position:0 -1764px}.flag.KR{background-position:0 -1778px}.flag.KW{background-position:0 -1792px}.flag.AD{background-position:0 -1806px}.flag.KZ{background-position:0 -1820px}.flag.LA{background-position:0 -1834px}.flag.LB{background-position:0 -1848px}.flag.LC{background-position:0 -1862px}.flag.LI{background-position:0 -1876px}.flag.LK{background-position:0 -1890px}.flag.LR{background-position:0 -1904px}.flag.LS{background-position:0 -1918px}.flag.LT{background-position:0 -1932px}.flag.LU{background-position:0 -1946px}.flag.LV{background-position:0 -1960px}.flag.LY{background-position:0 -1974px}.flag.MA{background-position:0 -1988px}.flag.MC{background-position:0 -2002px}.flag.MD{background-position:0 -2016px}.flag.ME{background-position:0 -2030px}.flag.MF{background-position:0 -2044px}.flag.MG{background-position:0 -2058px}.flag.MH{background-position:0 -2072px}.flag.MK{background-position:0 -2086px}.flag.ML{background-position:0 -2100px}.flag.MM{background-position:0 -2114px}.flag.MN{background-position:0 -2128px}.flag.MO{background-position:0 -2142px}.flag.MP{background-position:0 -2156px}.flag.MQ{background-position:0 -2170px}.flag.MR{background-position:0 -2184px}.flag.MS{background-position:0 -2198px}.flag.MT{background-position:0 -2212px}.flag.MU{background-position:0 -2226px}.flag.MV{background-position:0 -2240px}.flag.MW{background-position:0 -2254px}.flag.MX{background-position:0 -2268px}.flag.MY{background-position:0 -2282px}.flag.MZ{background-position:0 -2296px}.flag.NA{background-position:0 -2310px}.flag.NC{background-position:0 -2324px}.flag.NE{background-position:0 -2338px}.flag.NF{background-position:0 -2352px}.flag.NG{background-position:0 -2366px}.flag.NI{background-position:0 -2380px}.flag.NL{background-position:0 -2394px}.flag.NO{background-position:0 -2408px}.flag.NP{background-position:0 -2422px}.flag.NR{background-position:0 -2436px}.flag.NU{background-position:0 -2450px}.flag.NZ{background-position:0 -2464px}.flag.OM{background-position:0 -2478px}.flag.PA{background-position:0 -2492px}.flag.PE{background-position:0 -2506px}.flag.PF{background-position:0 -2520px}.flag.PG{background-position:0 -2534px}.flag.PH{background-position:0 -2548px}.flag.PK{background-position:0 -2562px}.flag.PL{background-position:0 -2576px}.flag.PM{background-position:0 -2590px}.flag.PN{background-position:0 -2604px}.flag.PR{background-position:0 -2618px}.flag.PS{background-position:0 -2632px}.flag.PT{background-position:0 -2646px}.flag.PW{background-position:0 -2660px}.flag.PY{background-position:0 -2674px}.flag.QA{background-position:0 -2688px}.flag.RE{background-position:0 -2702px}.flag.RO{background-position:0 -2716px}.flag.RS{background-position:0 -2730px}.flag.RU{background-position:0 -2744px}.flag.RW{background-position:0 -2758px}.flag.SA{background-position:0 -2772px}.flag.SB{background-position:0 -2786px}.flag.SC{background-position:0 -2800px}.flag.SD{background-position:0 -2814px}.flag.SE{background-position:0 -2828px}.flag.SG{background-position:0 -2842px}.flag.SH{background-position:0 -2856px}.flag.SI{background-position:0 -2870px}.flag.SJ{background-position:0 -2884px}.flag.SK{background-position:0 -2898px}.flag.SL{background-position:0 -2912px}.flag.SM{background-position:0 -2926px}.flag.SN{background-position:0 -2940px}.flag.SO{background-position:0 -2954px}.flag.SR{background-position:0 -2968px}.flag.SS{background-position:0 -2982px}.flag.ST{background-position:0 -2996px}.flag.SV{background-position:0 -3010px}.flag.SX{background-position:0 -3024px}.flag.SY{background-position:0 -3038px}.flag.SZ{background-position:0 -3052px}.flag.TA{background-position:0 -3066px}.flag.TC{background-position:0 -3080px}.flag.TD{background-position:0 -3094px}.flag.TF{background-position:0 -3108px}.flag.TG{background-position:0 -3122px}.flag.TH{background-position:0 -3136px}.flag.TJ{background-position:0 -3150px}.flag.TK{background-position:0 -3164px}.flag.TL{background-position:0 -3178px}.flag.TM{background-position:0 -3192px}.flag.TN{background-position:0 -3206px}.flag.TO{background-position:0 -3220px}.flag.TR{background-position:0 -3234px}.flag.TT{background-position:0 -3248px}.flag.TV{background-position:0 -3262px}.flag.TW{background-position:0 -3276px}.flag.TZ{background-position:0 -3290px}.flag.UA{background-position:0 -3304px}.flag.UG{background-position:0 -3318px}.flag.UM{background-position:0 -3332px}.flag.UN{background-position:0 -3346px}.flag.US{background-position:0 -3360px}.flag.UY{background-position:0 -3374px}.flag.UZ{background-position:0 -3388px}.flag.VA{background-position:0 -3402px}.flag.VC{background-position:0 -3416px}.flag.VE{background-position:0 -3430px}.flag.VG{background-position:0 -3444px}.flag.VI{background-position:0 -3458px}.flag.VN{background-position:0 -3472px}.flag.VU{background-position:0 -3486px}.flag.WF{background-position:0 -3500px}.flag.WS{background-position:0 -3514px}.flag.XK{background-position:0 -3528px}.flag.YE{background-position:0 -3542px}.flag.YT{background-position:0 -3556px}.flag.ZA{background-position:0 -3570px}.flag.ZM{background-position:0 -3584px}.flag.ZW{background-position:0 -3598px}"]
    }),
    __metadata("design:paramtypes", [CountryCode])
], LacMatCountrySelectorComponent);
export { LacMatCountrySelectorComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGFjLW1hdC1jb3VudHJ5LXNlbGVjdG9yLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2xhYy1tYXQtdGVsLWlucHV0LyIsInNvdXJjZXMiOlsibGliL2xhYy1tYXQtY291bnRyeS1zZWxlY3Rvci9sYWMtbWF0LWNvdW50cnktc2VsZWN0b3IuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxZQUFZLEVBQWEsTUFBTSxFQUFFLGlCQUFpQixFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUV4SCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFFbkQsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFFekUsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBU25ELElBQWEsOEJBQThCLEdBQTNDLE1BQWEsOEJBQThCO0lBK0J6QyxZQUNVLGVBQTRCO1FBQTVCLG9CQUFlLEdBQWYsZUFBZSxDQUFhO1FBM0J0Qyx1QkFBa0IsR0FBa0IsRUFBRSxDQUFDO1FBRXZDLGtCQUFhLEdBQWtCLEVBQUUsQ0FBQztRQVNsQyxXQUFNLEdBQTBCLElBQUksWUFBWSxFQUFXLENBQUM7UUFHNUQsaUJBQVksR0FBbUIsRUFBRSxDQUFDO1FBQ2xDLGlDQUE0QixHQUFtQixFQUFFLENBQUM7UUFjaEQsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7SUFDMUIsQ0FBQztJQWJELElBQUksUUFBUTtRQUNWLE9BQU8sSUFBSSxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQztJQUN2RCxDQUFDO0lBYUQsZ0NBQWdDO0lBQ3RCLGdCQUFnQjtRQUN4QixJQUFJLENBQUMsZUFBZSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUU7WUFDNUMsTUFBTSxPQUFPLEdBQVk7Z0JB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Y2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIEV2ZW50RW1pdHRlciwgT25EZXN0cm95LCBPdXRwdXQsIFZpZXdFbmNhcHN1bGF0aW9uLCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENvdW50cnkgfSBmcm9tICcuLi9tb2RlbC9jb3VudHJ5Lm1vZGVsJztcbmltcG9ydCB7IENvdW50cnlDb2RlIH0gZnJvbSAnLi4vZGF0YS9jb3VudHJ5LWNvZGUnO1xuaW1wb3J0IHsgQ291bnRyeUNvZGUgYXMgTGliQ291bnRyeUNvZGUgfSAgZnJvbSAnbGlicGhvbmVudW1iZXItanMnO1xuaW1wb3J0IHsgTGFjTWF0VGVsSW5wdXRDb21wb25lbnQgfSBmcm9tICcuLi9sYWMtbWF0LXRlbC1pbnB1dC5jb21wb25lbnQnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBNYXRJbnB1dCB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL2lucHV0JztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbGFjLW1hdC1jb3VudHJ5LXNlbGVjdG9yJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2xhYy1tYXQtY291bnRyeS1zZWxlY3Rvci5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2xhYy1tYXQtY291bnRyeS1zZWxlY3Rvci5jb21wb25lbnQuc2NzcyddLFxuICBwcm92aWRlcnM6IFtDb3VudHJ5Q29kZV0sXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmVcbn0pXG5leHBvcnQgY2xhc3MgTGFjTWF0Q291bnRyeVNlbGVjdG9yQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xuXG4gIEBJbnB1dCgpIFxuICBzZWxlY3RvckZvcjogTGFjTWF0VGVsSW5wdXRDb21wb25lbnQ7XG4gIEBJbnB1dCgpIFxuICBwcmVmZXJyZWRDb3VudHJpZXM6IEFycmF5PHN0cmluZz4gPSBbXTtcbiAgQElucHV0KCkgXG4gIG9ubHlDb3VudHJpZXM6IEFycmF5PHN0cmluZz4gPSBbXTtcbiAgQElucHV0KClcbiAgc2hvd0RpYWxDb2RlPzogYm9vbGVhbjtcbiAgQElucHV0KClcbiAgZGlzYWJsZVNlYXJjaD86IGJvb2xlYW47XG4gIEBJbnB1dCgpXG4gIHNlYXJjaFBsYWNlaG9sZGVyPzogc3RyaW5nO1xuXG4gIEBPdXRwdXQoKVxuICBjaGFuZ2U6IEV2ZW50RW1pdHRlcjxDb3VudHJ5PiA9IG5ldyBFdmVudEVtaXR0ZXI8Q291bnRyeT4oKTtcblxuICBzZWxlY3RlZENvdW50cnk6IENvdW50cnk7XG4gIGFsbENvdW50cmllczogQXJyYXk8Q291bnRyeT4gPSBbXTtcbiAgcHJlZmVycmVkQ291bnRyaWVzSW5Ecm9wRG93bjogQXJyYXk8Q291bnRyeT4gPSBbXTtcblxuICBnZXQgZGlzYWJsZWQoKSA6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnNlbGVjdG9yRm9yICYmIHRoaXMuc2VsZWN0b3JGb3IuZGlzYWJsZWQ7XG4gIH1cbiAgXG4gIHNlYXJjaFF1ZXJ5OiBzdHJpbmc7XG4gIEBWaWV3Q2hpbGQoJ3NlYXJjaElucHV0Jykgc2VhcmNoSW5wdXQ6IE1hdElucHV0O1xuXG4gIHByaXZhdGUgY291bnRyeVN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgY291bnRyeUNvZGVEYXRhOiBDb3VudHJ5Q29kZVxuICApIHsgXG4gICAgdGhpcy5mZXRjaENvdW50cnlEYXRhKCk7XG4gIH1cblxuICAvL2J1aWxkcyB0aGUgQWxsIENvdW50cmllcyBhcnJheVxuICBwcm90ZWN0ZWQgZmV0Y2hDb3VudHJ5RGF0YSgpOiB2b2lkIHtcbiAgICB0aGlzLmNvdW50cnlDb2RlRGF0YS5hbGxDb3VudHJpZXMuZm9yRWFjaChjID0+IHtcbiAgICAgIGNvbnN0IGNvdW50cnk6IENvdW50cnkgPSB7XG4gICAgICAgIG5hbWU6IGNbMF0udG9TdHJpbmcoKSxcbiAgICAgICAgaXNvMjogY1sxXS50b1N0cmluZygpLFxuICAgICAgICBkaWFsQ29kZTogY1syXS50b1N0cmluZygpLFxuICAgICAgICBwcmlvcml0eTogK2NbM10gfHwgMCxcbiAgICAgICAgYXJlYUNvZGVzOiBjWzRdIGFzIHN0cmluZ1tdIHx8IHVuZGVmaW5lZCxcbiAgICAgICAgZmxhZ0NsYXNzOiBjWzFdLnRvU3RyaW5nKCkudG9VcHBlckNhc2UoKSxcbiAgICAgICAgcGxhY2VIb2xkZXI6ICcnXG4gICAgICB9O1xuXG4gICAgICB0aGlzLmFsbENvdW50cmllcy5wdXNoKGNvdW50cnkpO1xuICAgIH0pO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgLy9idWlsZCBwcmVmZXJyZWQgY291bnRyaWVzIGFycmF5cyBpZiB0aGV5IGFyZSBzcGVjaWZpZWRcbiAgICBpZiAodGhpcy5wcmVmZXJyZWRDb3VudHJpZXMubGVuZ3RoKSB7XG4gICAgICB0aGlzLnByZWZlcnJlZENvdW50cmllcy5mb3JFYWNoKGlzbzIgPT4ge1xuICAgICAgICBjb25zdCBwcmVmZXJyZWRDb3VudHJ5ID0gdGhpcy5hbGxDb3VudHJpZXMuZmlsdGVyKChjKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGMuaXNvMiA9PT0gaXNvMjtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucHJlZmVycmVkQ291bnRyaWVzSW5Ecm9wRG93bi5wdXNoKHByZWZlcnJlZENvdW50cnlbMF0pO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy9maWx0ZXIgY291bnRyaWVzIGlmIHJlcXVpcmVkXG4gICAgaWYgKHRoaXMub25seUNvdW50cmllcy5sZW5ndGgpIHtcbiAgICAgIHRoaXMuYWxsQ291bnRyaWVzID0gdGhpcy5hbGxDb3VudHJpZXMuZmlsdGVyKGMgPT4gdGhpcy5vbmx5Q291bnRyaWVzLmluY2x1ZGVzKGMuaXNvMikpO1xuICAgIH1cblxuICAgIC8vc2V0IHRoZSBkZWZhdWx0IHNlbGVjdGVkIGEgY291bnRyeVxuICAgIGxldCBkZWZhdWx0Q291bnRyeTogQ291bnRyeTtcbiAgICBpZiAodGhpcy5wcmVmZXJyZWRDb3VudHJpZXNJbkRyb3BEb3duLmxlbmd0aCkge1xuICAgICAgZGVmYXVsdENvdW50cnkgPSB0aGlzLnByZWZlcnJlZENvdW50cmllc0luRHJvcERvd25bMF07XG4gICAgfSBlbHNlIHtcbiAgICAgIGRlZmF1bHRDb3VudHJ5ID0gdGhpcy5hbGxDb3VudHJpZXNbMF07XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuc2VsZWN0b3JGb3IpIHtcbiAgICAgIHRoaXMuY291bnRyeVN1YnNjcmlwdGlvbiA9IHRoaXMuc2VsZWN0b3JGb3IuY291bnRyeUNoYW5nZS5zdWJzY3JpYmUoYyA9PiB0aGlzLm9uQ291bnRyeVVwZGF0ZUZyb21JbnB1dChjKSk7XG4gICAgfVxuXG4gICAgdGhpcy5zZWxlY3RDb3VudHJ5KGRlZmF1bHRDb3VudHJ5KTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIGlmICh0aGlzLmNvdW50cnlTdWJzY3JpcHRpb24pIHtcbiAgICAgIHRoaXMuY291bnRyeVN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIH1cbiAgfVxuXG4gIHNlbGVjdENvdW50cnkoY291bnRyeTogQ291bnRyeSkge1xuICAgIHRoaXMuc2VsZWN0ZWRDb3VudHJ5ID0gY291bnRyeTtcblxuICAgIGlmICh0aGlzLnNlbGVjdG9yRm9yKSB7XG4gICAgICB0aGlzLnNlbGVjdG9yRm9yLm9uQ291bnRyeVNlbGVjdGVkKDxMaWJDb3VudHJ5Q29kZT4gY291bnRyeS5mbGFnQ2xhc3MpO1xuICAgIH1cbiAgICB0aGlzLmNoYW5nZS5uZXh0KGNvdW50cnkpO1xuICB9XG5cbiAgcHJpdmF0ZSBvbkNvdW50cnlVcGRhdGVGcm9tSW5wdXQoY29kZTogTGliQ291bnRyeUNvZGUpIHtcbiAgICBsZXQgY291bnRyeSA9IHRoaXMuYWxsQ291bnRyaWVzLmZpbmQoKGMpID0+IHtcbiAgICAgIHJldHVybiBjLmZsYWdDbGFzcyA9PT0gY29kZS50b1N0cmluZygpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5zZWxlY3RlZENvdW50cnkgPSBjb3VudHJ5O1xuICAgIHRoaXMuY2hhbmdlLm5leHQoY291bnRyeSk7XG4gIH1cblxuICBvbk9wZW5NZW51Q2xpY2soKSB7XG4gICAgaWYgKCF0aGlzLmRpc2FibGVTZWFyY2ggJiYgdGhpcy5zZWFyY2hJbnB1dCkge1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLnNlYXJjaElucHV0LmZvY3VzKCkpO1xuICAgIH1cbiAgfVxuXG4gIG9uTWVudUNsb3NlZCgpIHtcbiAgICB0aGlzLnNlYXJjaFF1ZXJ5ID0gJyc7XG4gIH1cblxufVxuIl19